<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arbetsplan - Medborgarskolan</title>
    
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #525659;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        .page {
            background-color: white;
            width: 210mm;
            height: 297mm;
            padding: 20mm 20mm;
            box-sizing: border-box;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 40px;
        }

        .left-info {
            font-size: 11px;
            line-height: 1.3;
        }

        .logo-img {
            width: 170px;
            height: auto;
            margin-bottom: 20px;
            display: block;
        }

        .right-info {
            text-align: right;
        }

        .right-info h1 {
            margin: 0;
            font-size: 26px;
            font-weight: bold;
        }

        .right-info p {
            margin: 5px 0 0 0;
            font-size: 10px;
        }

        .main-title {
            font-size: 22px;
            font-weight: normal;
            margin-bottom: 10px;
        }

        hr {
            border: none;
            border-top: 1px solid #000;
            margin-bottom: 25px;
        }

        .intro-text {
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .intro-text p {
            margin: 0 0 5px 0;
        }

        .form-group {
            background-color: #fafafa;
            margin-bottom: 15px;
            padding: 2px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            padding: 8px 5px 5px 5px;
        }

        .form-group textarea {
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #777;
            padding: 10px;
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.35;
            resize: none;
            min-height: 70px;
            background-color: white;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: #1a2a6c;
        }

        .controls {
            margin-bottom: 20px;
            position: sticky;
            top: 20px;
            z-index: 100;
            width: 210mm;
            max-width: 100%;
            display: grid;
            gap: 10px;
        }

        .course-controls {
            display: grid;
            grid-template-columns: 180px 1fr;
            gap: 10px;
        }

        .course-controls input {
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #777;
            padding: 10px;
            font-size: 14px;
            font-family: Arial, Helvetica, sans-serif;
            border-radius: 4px;
        }

        .btn-download {
            background-color: #1a2a6c;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            transition: background 0.3s;
        }

        .btn-download:hover {
            background-color: #101a45;
        }

        .html2pdf__page-break { page-break-before: always; }

        @page {
            size: A4;
            margin: 0;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .controls {
                display: none;
            }

            .page {
                box-shadow: none;
                margin: 0;
            }
        }
    </style>
</head>
<body>

    <div class="controls">
        <div class="course-controls">
            <input id="course-code" type="text" inputmode="numeric" placeholder="Kurskod (siffror)" aria-label="Kurskod">
            <input id="course-name" type="text" placeholder="Kursnamn" aria-label="Kursnamn">
        </div>
        <button class="btn-download" onclick="generatePDF()">游 Spara som PDF</button>
    </div>

    <div class="page" id="document-content">
        
        <div class="header-container">
            <div class="left-info">
                <img 
                    src="logo-medborgarskolan.c3013527.svg" 
                    crossorigin="anonymous" 
                    id="org-logo"
                    class="logo-img" 
                    alt="Medborgarskolan">
                
                Medborgarskolan Syd<br>
                V칛stergatan 17<br>
                24131 ESL칐V<br>
                region.syd@medborgarskolan.se<br>
                www.medborgarskolan.se
            </div>
            <div class="right-info">
                <h1>Arbetsplan</h1>
                <p id="print-date"></p>
            </div>
        </div>

        <h2 class="main-title" id="course-title"></h2>
        <hr>

        <div class="intro-text">
            <p>Planering av gruppens studier.</p>
            <p>S친 kallad annan folkbildning 칛r en del av Medborgarskolans folkbildningsverksamhet som kan genomf칬ras i friare och flexiblare former. Det finns h칛r m칬jlighet att pr칬va nya id칠er och utveckla nyskapande folkbildningsverksamhet. Annan folkbildningsverksamhet kan till exempel vara en workshop, prova-p친-dagar, barnverksamhet (barn fr친n sex 친r) eller helgkurser d칛r sammankomsterna kan vara l칛ngre och genomf칬ras t칛tare 칛n i studiecirklar.</p>
            <p>Verksamheten ska vara styrd av deltagarnas 칬nskem친l om inneh친ll och uppl칛gg.</p>
            <p>Som st칬d f칬r er grupps utveckling och l칛rande ska det finnas en dokumenterad plan f칬r verksamhetens genomf칬rande och f칬r det studiematerial som ska anv칛ndas (F칬rordning (2015:218) om statsbidrag f칬r folkbildningen, 12춶).</p>
            <p>Ledaren arbetar fram arbetsplanen tillsammans med deltagarna och Medborgarskolan ansvarar d칛refter f칬r att godk칛nna arbetsplanen.</p>
            <p>Fyll i arbetsplanen nedan efter verksamhetens f칬rsta sammankomst.</p>
        </div>

        <div class="form-group">
            <label>1. Beskriv era m친l med verksamheten. (Vad vill ni l칛ra er? Vad 칛r syftet med verksamheten?) (obligatorisk uppgift)</label>
            <textarea rows="3"></textarea>
        </div>

        <div class="form-group">
            <label>2. Ber칛tta hur ni ska g칬ra f칬r att n친 era m친l. (Hur ska ni g칬ra f칬r att l칛ra er?) (obligatorisk uppgift)</label>
            <textarea rows="3"></textarea>
        </div>

        <div class="form-group">
            <label>3. Beskriv det studiematerial/de kunskapsk칛llor ni ev kommer att anv칛nda. (Ange namn p친 litteratur, digitala medier, annat studiematerial och/eller beskrivning av ledarens och/eller deltagarnas kunskaper. Materialet ska vid behov vara kontrollerbart.) (obligatorisk uppgift)</label>
            <textarea rows="3"></textarea>
        </div>

        <div class="form-group">
            <label>4. Ber칛tta vilka resurser och/eller vilket st칬d ni har kommit 칬verens med Medborgarskolan om att verksamheten beh칬ver f칬r att n친 era m친l. (Tex utbildning, lokal, pedagogiskt/administrativt st칬d, kursmaterial, arbetsmaterial, marknadsf칬ring). (obligatorisk uppgift)</label>
            <textarea rows="3"></textarea>
        </div>

    </div>

    <script>
        const MAX_TEXTAREA_FONT_SIZE = 20;
        const MIN_TEXTAREA_FONT_SIZE = 11;
        const TEXTAREA_FONT_STEP = 0.5;

        function updateCourseTitle() {
            const codeInput = document.getElementById('course-code');
            const nameInput = document.getElementById('course-name');
            const title = document.getElementById('course-title');
            if (!codeInput || !nameInput || !title) {
                return;
            }

            const code = (codeInput.value || '').replace(/\D/g, '');
            if (codeInput.value !== code) {
                codeInput.value = code;
            }
            const name = (nameInput.value || '').trim();
            title.textContent = code && name ? (code + ' - ' + name) : '';
        }

        function fitTextareaText(textarea) {
            if (!textarea) {
                return;
            }

            let fontSize = MAX_TEXTAREA_FONT_SIZE;
            textarea.style.fontSize = fontSize + 'px';

            while (textarea.scrollHeight > textarea.clientHeight + 1 && fontSize > MIN_TEXTAREA_FONT_SIZE) {
                fontSize = Math.max(MIN_TEXTAREA_FONT_SIZE, fontSize - TEXTAREA_FONT_STEP);
                textarea.style.fontSize = fontSize + 'px';
            }

            // Grow short text to use the box better without forcing tiny/huge jumps.
            while (textarea.scrollHeight < textarea.clientHeight * 0.8 && fontSize < MAX_TEXTAREA_FONT_SIZE) {
                const nextSize = Math.min(MAX_TEXTAREA_FONT_SIZE, fontSize + TEXTAREA_FONT_STEP);
                textarea.style.fontSize = nextSize + 'px';
                if (textarea.scrollHeight > textarea.clientHeight + 1) {
                    textarea.style.fontSize = fontSize + 'px';
                    break;
                }
                fontSize = nextSize;
            }
        }

        function initResponsiveTextareaFonts() {
            const textareas = document.querySelectorAll('.form-group textarea');
            textareas.forEach((textarea) => {
                fitTextareaText(textarea);
                textarea.addEventListener('input', () => fitTextareaText(textarea));
            });

            window.addEventListener('resize', () => {
                textareas.forEach((textarea) => fitTextareaText(textarea));
            });
        }

        async function ensureLogoLoaded() {
            const logo = document.getElementById('org-logo');
            if (!logo) {
                return;
            }

            if (logo.complete && logo.naturalWidth > 0) {
                return;
            }

            await new Promise((resolve) => {
                let done = false;
                const finish = () => {
                    if (done) {
                        return;
                    }
                    done = true;
                    logo.removeEventListener('load', finish);
                    logo.removeEventListener('error', finish);
                    resolve();
                };

                logo.addEventListener('load', finish, { once: true });
                logo.addEventListener('error', finish, { once: true });
                setTimeout(finish, 1500);
            });
        }

        async function generatePDF() {
            const btn = document.querySelector('.btn-download');
            const element = document.getElementById('document-content');
            const codeInput = document.getElementById('course-code');
            const nameInput = document.getElementById('course-name');

            if (!btn || !element || !codeInput || !nameInput) {
                return;
            }

            const courseCode = (codeInput.value || '').replace(/\D/g, '');
            const courseName = (nameInput.value || '').trim();
            codeInput.value = courseCode;
            nameInput.value = courseName;
            updateCourseTitle();

            if (!courseCode) {
                alert('Ange kurskod f칬rst (endast siffror).');
                codeInput.focus();
                return;
            }

            if (!courseName) {
                alert('Ange kursnamn.');
                nameInput.focus();
                return;
            }

            const replacements = [];
            const textareas = element.querySelectorAll('textarea');

            textareas.forEach((textarea) => {
                fitTextareaText(textarea);
                const computed = window.getComputedStyle(textarea);
                const staticBlock = document.createElement('div');

                staticBlock.textContent = textarea.value || '';
                staticBlock.style.width = '100%';
                staticBlock.style.boxSizing = 'border-box';
                staticBlock.style.border = computed.border;
                staticBlock.style.padding = computed.padding;
                staticBlock.style.fontFamily = computed.fontFamily;
                staticBlock.style.fontSize = computed.fontSize;
                staticBlock.style.lineHeight = computed.lineHeight;
                staticBlock.style.minHeight = computed.minHeight;
                staticBlock.style.backgroundColor = computed.backgroundColor;
                staticBlock.style.color = computed.color;
                staticBlock.style.whiteSpace = 'pre-wrap';
                staticBlock.style.overflowWrap = 'anywhere';
                staticBlock.style.wordBreak = 'break-all';

                textarea.style.display = 'none';
                textarea.parentNode.insertBefore(staticBlock, textarea.nextSibling);
                replacements.push({ textarea, staticBlock });
            });

            const originalText = btn.innerText;
            btn.innerText = "칐ppnar utskrift...";
            btn.disabled = true;
            await ensureLogoLoaded();

            const restoreFormState = () => {
                replacements.forEach(({ textarea, staticBlock }) => {
                    if (staticBlock.parentNode) {
                        staticBlock.parentNode.removeChild(staticBlock);
                    }
                    textarea.style.display = '';
                });
                btn.innerText = originalText;
                btn.disabled = false;
            };

            const onAfterPrint = () => {
                restoreFormState();
                window.removeEventListener('afterprint', onAfterPrint);
            };

            window.addEventListener('afterprint', onAfterPrint);
            window.print();

            // Fallback if afterprint is not fired by the browser.
            setTimeout(() => {
                if (btn.disabled) {
                    restoreFormState();
                    window.removeEventListener('afterprint', onAfterPrint);
                }
            }, 1500);
        }

        (function setPrintDate() {
            const dateElement = document.getElementById('print-date');
            if (!dateElement) {
                return;
            }
            const today = new Date().toISOString().slice(0, 10);
            dateElement.textContent = "Utskriftsdatum " + today;
        })();

        initResponsiveTextareaFonts();
        (function initCourseFields() {
            const codeInput = document.getElementById('course-code');
            const nameInput = document.getElementById('course-name');
            if (!codeInput || !nameInput) {
                return;
            }
            codeInput.addEventListener('input', updateCourseTitle);
            nameInput.addEventListener('input', updateCourseTitle);
            updateCourseTitle();
        })();
    </script>
</body>
</html>
